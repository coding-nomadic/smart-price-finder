<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Smart Price Finder</title>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: #121212;
            color: #ffffff;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        /* Vertically center form even when stores exist */
        .form-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 15px;
            min-height: 50vh;
        }

        /* Title above form */
        .form-title {
            font-size: 2rem;
            font-weight: 500;
            color: #4da6ff;
            margin-bottom: 20px;
            text-align: center;
        }

        form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px 16px;
            font-size: 0.95rem;
            border-radius: 24px;
            border: 1px solid #ccc;
            background: #1f1f1f;
            color: #fff;
            transition: 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #4da6ff;
            box-shadow: 0 0 8px rgba(77, 166, 255, 0.5);
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        select, button {
            flex: 1 1 120px;
            min-width: 100px;
            padding: 10px;
            border-radius: 24px;
            border: none;
            font-size: 0.95rem;
        }

        button {
            background: #4da6ff;
            color: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: #3399ff;
        }

        .results-container {
        width: 100%;
        margin-top: 10px; /* smaller gap from form */
        display: flex;
        flex-direction: column;
        gap: 15px; /* spacing between cards */
        }

        @media (max-width: 768px) {
        .results-container {
        margin-top: 5px; /* even smaller gap on mobile */
        }
        }

        .store-card {
            background: #1e1e1e;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .store-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.6);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
        }

        .left-info {
            flex: 2;
            font-size: 0.95rem;
        }

        .right-info {
            flex: 1;
            text-align: right;
            font-size: 1rem;
            font-weight: 600;
        }

        .right-info .price { color: #4da6ff; font-size: 1.2rem; font-weight: bold; }
        .right-info .discount { color: #ff9800; }
        .right-info .rating { color: #fbc02d; }

        .availability.in-stock { color: #4caf50; font-weight: bold; }
        .availability.low-stock { color: #ff9800; font-weight: bold; }
        .availability.out-of-stock { color: #f44336; font-weight: bold; }

        .error {
            background: #f44336;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }

        #toast {
            display:none;
            margin:10px auto;
            padding:16px 22px;
            background:#ff9800;
            color:#fff;
            border-radius:10px;
            text-align:center;
            max-width:400px;
            font-weight:bold;
            font-size: 0.95rem;
            box-shadow:0 2px 6px rgba(0,0,0,0.5);
            opacity:0;
            transition: opacity 0.5s;
        }

        /* Right sliding sidebar */
        .side-nav {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: #1f1f1f;
            border-radius: 8px 0 0 8px;
            overflow: hidden;
            transition: width 0.3s;
            width: 50px;
            z-index: 1000;
        }

        .side-nav:hover { width: 150px; }
        .side-nav ul { list-style: none; padding: 0; margin: 0; }
        .side-nav ul li { display: block; text-align: center; margin: 10px 0; }
        .side-nav ul li a {
            display: block; color: #4da6ff; padding: 10px; text-decoration: none;
            font-weight: bold; white-space: nowrap; transition: 0.2s;
        }
        .side-nav ul li a:hover { background-color: #333; border-radius: 4px; }

        /* Mobile responsiveness */
        @media (max-width:768px){
            .form-title { font-size: 1.8rem; }
            input[type="text"], select, button { font-size: 0.95rem; padding: 10px; }
            .card-header { flex-direction: column; gap: 10px; }
            .right-info { text-align: left; }
        }
    </style>
</head>
<body>

<div class="side-nav">
    <ul>
        <li><a th:href="@{/}">Home</a></li>
        <li><a th:href="@{/about}">About</a></li>
        <li><a th:href="@{/contact}">Contact Us</a></li>
    </ul>
</div>

<div class="container">
    <div class="form-wrapper" th:class="${#lists.isEmpty(stores)} ? 'form-wrapper' : 'form-wrapper'">
        <div class="form-title">Smart Price Finder</div>
        <form action="/generate" method="post">
            <input type="text" name="query" placeholder="Search for a product..." required>
            <div class="row">
                <select id="province" name="province" required>
                    <option value="" disabled selected>Province</option>
                    <option value="AB">Alberta</option>
                    <option value="BC">British Columbia</option>
                    <option value="MB">Manitoba</option>
                    <option value="NB">New Brunswick</option>
                    <option value="NL">Newfoundland and Labrador</option>
                    <option value="NS">Nova Scotia</option>
                    <option value="ON">Ontario</option>
                    <option value="PE">Prince Edward Island</option>
                    <option value="QC">Quebec</option>
                    <option value="SK">Saskatchewan</option>
                    <option value="NT">Northwest Territories</option>
                    <option value="NU">Nunavut</option>
                    <option value="YT">Yukon</option>
                </select>
                <select id="city" name="city" required>
                    <option value="" disabled selected>City</option>
                </select>
                <button type="submit">Find Prices</button>
            </div>
        </form>
    </div>

    <div th:if="${error}" class="error" th:text="${error}"></div>
    <div id="toast">No Product Found in this location, try some other locations!</div>

    <!-- Store Results -->
    <div class="results-container">
        <div th:each="store : ${stores}" class="store-card" th:data-availability="${store.availability}">
            <div class="card-header">
                <div class="left-info">
                    <h3 th:text="${store.productName}">Product Name</h3>
                    <p><strong>Store:</strong> <span th:text="${store.storeName}">Store Name</span> (<span th:text="${store.storeType}">Type</span>)</p>
                    <p><strong>Availability:</strong>
                        <span class="availability"
                              th:classappend="${store.availability == 'In Stock'} ? ' in-stock' :
                                              (${store.availability == 'Low Stock'} ? ' low-stock' : ' out-of-stock')"
                              th:text="${store.availability}">
                        </span>
                    </p>
                    <p><strong>Distance:</strong> <span th:text="${store.distance}">0</span></p>
                    <p><strong>Address:</strong> <span th:text="${store.location}">Address</span></p>
                    <p><strong>Last Updated:</strong> <span th:text="${store.lastUpdated}">Today</span></p>
                    <p><strong>Website:</strong> <a th:href="${store.website}" target="_blank">Visit Store</a></p>
                </div>
                <div class="right-info">
                    <p class="price">üí≤ $<span th:text="${store.price}">0.00</span></p>
                    <p class="discount">üéØ <span th:text="${store.discount}">0%</span></p>
                    <p class="rating">‚≠ê <span th:text="${store.rating}">0</span>/5</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const provinceCities = {
     "AB": ["Calgary","Edmonton","Red Deer","Lethbridge","Fort McMurray","Medicine Hat","Grande Prairie","Spruce Grove","Airdrie","St. Albert","Lloydminster","Camrose"],
     "BC": ["Vancouver","Victoria","Kelowna","Surrey","Burnaby","Richmond","Abbotsford","Nanaimo","Kamloops","Coquitlam","Langley","Delta","North Vancouver","West Vancouver"],
     "MB": ["Winnipeg","Brandon","Steinbach","Thompson","Portage la Prairie","Selkirk","Morden","Winkler","Dauphin","Flin Flon"],
     "NB": ["Moncton","Fredericton","Saint John","Dieppe","Miramichi","Bathurst","Riverview","Edmundston","Campbellton","Oromocto"],
     "NL": ["St. John's","Mount Pearl","Corner Brook","Gander","Grand Falls-Windsor","Clarenville","Conception Bay South","Paradise","Bay Roberts","Carbonear"],
     "NS": ["Halifax","Sydney","Dartmouth","Truro","New Glasgow","Glace Bay","Sydney Mines","Kentville","Bridgewater","Yarmouth"],
     "ON": ["Toronto","Ottawa","Hamilton","London","Mississauga","Brampton","Kitchener","Windsor","Thunder Bay","Waterloo","Markham","Vaughan","Richmond Hill","Burlington","Oakville","Niagara Falls","Guelph","Barrie","St. Catharines"],
     "PE": ["Charlottetown","Summerside","Stratford","Cornwall","Montague","Souris","Georgetown","Borden-Carleton"],
     "QC": ["Montreal","Quebec City","Laval","Gatineau","Longueuil","Sherbrooke","Trois-Rivi√®res","L√©vis","Blainville","Brossard","Saint-Jean-sur-Richelieu","Repentigny","Drummondville","Saint-J√©r√¥me"],
     "SK": ["Saskatoon","Regina","Prince Albert","Moose Jaw","Yorkton","Swift Current","North Battleford","Estevan","Weyburn","Lloydminster"],
     "NT": ["Yellowknife","Hay River","Fort Smith","Inuvik","Behchoko","Norman Wells"],
     "NU": ["Iqaluit","Rankin Inlet","Arviat","Cambridge Bay","Pangnirtung","Igloolik","Baker Lake"],
     "YT": ["Whitehorse","Dawson City","Watson Lake","Haines Junction","Carmacks","Burwash Landing"]
 };

     const provinceSelect = document.getElementById('province');
     const citySelect = document.getElementById('city');

     provinceSelect.addEventListener('change', function() {
         const cities = provinceCities[this.value] || [];
         citySelect.innerHTML = '<option value="" disabled selected>City</option>';
         cities.forEach(city => {
             const option = document.createElement('option');
             option.value = city;
             option.textContent = city;
             citySelect.appendChild(option);
         });
     });
</script>
</body>
</html>
